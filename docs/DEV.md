# BibleBase Development

## Interface

The json for each verse is in format defined in `docs/bible-references-sample.json`, it is the contract between different layers:
* Crawlers generates the file of this format,
* Backend (in the future) returns json in this format, and
* Frontend handles json in this format.

## Run Crawler

TODO: it changed

```bash
$ cd src/crawlers
$ bundle install
$ ./start
```

And run chapter by chapter according to the help text from `./start`

### Merge jsons

```bash
brew install parallel
cd src/data/verses_data
find . -type d | parallel bash ../jq-merge
```

## Deployment

To upload every generated json file sitting in `./src/data/json` folder to AWS `s3://biblebase/json`.
The folder structure of json folder is:
```
book_index/
  chapter_num/
    - sermons.json
    verse_num/
      - merged.json
      - versions.json (TODO)
      - hymns.json (TODO)
      - interpretations.json (TODO)
      - words.json
      - analytics.json
      - sermons.json
```

### Prerequisite

1. Access to s3 bucket `biblebase`
1. Files generated by the crawlers

### Steps

1. aws cp
   ```bash
   $ cd HOME/src/crawlers
   $ aws cp --recursive json/ s3://biblebase/verse_data/
   ```
1. publish them all
   1. go to s3 console on AWS
   1. select folder `s3://biblebase/verse_data`
   1. Actions Menu -> make public
